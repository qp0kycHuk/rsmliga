<div id="participant-edit">
  <form @submit="submitHandler" class="dialog-participant participant card">
    <div class="grid grid-spacing-sm-9">
      <div class="grid-col-8 grid-col-sm-4 grid-col-lg-3">
        <label class="participant-avatar image image--box">
          <input type="file" accept="image/*" @change="avatarChangeHandler">
          <div class="participant-avatar-letter">
            a
          </div>
          <div class="participant-avatar-image">
            <img :src="data.avatar" alt="">
          </div>
          <div class="participant-avatar-label">
            <svg class="icon">
              <use xlink:href="img/icons.svg#image" />
            </svg>
          </div>
        </label>
      </div>
      <div class="grid-col-lg-9">
        <div class="flex flex-wrap mb-6 flex-align-center">
          <div class="text-h6">
            Карточка участника (<span class="color-primary">ID №
              {{ data.id }}</span>)
          </div>
          <div class="participant-status ml-md-auto">
            <img src="img/circle-check.png" alt="" class="mr-2">
            <div class="fade-80 text-body-2">Активирован</div>
          </div>
        </div>
        <div class="participant-info">
          <div class="participant-info-row w-100">
            <label class="form-field w-100 w-sm-1/2 w-lg-1/3">
              <div class="text-body-1 text--demibold mb-2">Фамилия<span class="color-primary">*</span></div>
              <div class="form-input-cover">
                <input type="text" class="form-input" name="name" required value="Синельников">
              </div>
            </label>
            <label class="form-field w-100 w-sm-1/2 w-lg-1/3">
              <div class="text-body-1 text--demibold mb-2">Имя<span class="color-primary">*</span></div>
              <div class="form-input-cover">
                <input type="text" class="form-input" name="sirname" required value="Валерий">
              </div>
            </label>
          </div>
          <div class="participant-info-row w-100">
            <label class="form-field w-100 w-sm-1/2 w-lg-1/3">
              <div class="text-body-1 text--demibold mb-2">Отчество<span class="color-primary">*</span></div>
              <div class="form-input-cover">
                <input type="text" class="form-input" name="name" required value="Иванович">
              </div>
            </label>
            <label class="form-field w-100 w-sm-1/2 w-lg-1/3">
              <div class="text-body-1 text--demibold mb-2">Дата рождения<span class="color-primary">*</span></div>
              <div class="form-input-cover">
                <input type="date" class="form-input" name="birthday" required value="2010-01-10">
              </div>
            </label>

          </div>
          <div class="participant-info-row w-100">
            <label class="form-field w-100 w-lg-1/3">
              <div class="text-body-1 text--demibold mb-2">Пол<span class="color-primary">*</span></div>
              <div class="form-input-cover">
                <select name="sex" id="" class="form-input">
                  <option value="мужской">мужской</option>
                  <option value="не мужской">не мужской</option>
                </select>
                <div class="form-input-end pe-none pr-3">
                  <svg class="icon text-small">
                    <use xlink:href="img/icons.svg#to-down" />
                  </svg>
                </div>
              </div>
            </label>
          </div>
        </div>
      </div>
    </div>
    <div class="bd-top my-8"></div>
    <div class="participant-info">
      <label class="form-field w-100">
        <div class="text-body-1 text--demibold mb-2">Место учебы</div>
        <div class="form-input-cover">
          <select name="school" id="" class="form-input">
            <option value="1">МБОУ СОШ №23 (Первомайский р-н. г. Ростов-на-Дону)</option>
            <option value="2">МБОУ СОШ №24 (Первомайский р-н. г. Ростов-на-Дону)</option>
          </select>
          <div class="form-input-end pe-none pr-3">
            <svg class="icon text-small">
              <use xlink:href="img/icons.svg#to-down" />
            </svg>
          </div>
        </div>
      </label>
      <label class="form-field w-100">
        <div class="text-body-1 text--demibold mb-2">Спортивная школа/клуб</div>
        <div class="form-input-cover">
          <select name="sport_school" id="" class="form-input">
            <option value="1">ГБУ РО СШОР №5 (Первомайский р-н. г. Ростов-на-Дону)</option>
            <option value="2">ГБУ РО СШОР №6 (Первомайский р-н. г. Ростов-на-Дону)</option>
          </select>
          <div class="form-input-end pe-none pr-3">
            <svg class="icon text-small">
              <use xlink:href="img/icons.svg#to-down" />
            </svg>
          </div>
        </div>
      </label>
    </div>
    <div class="bd-top my-8"></div>
    <div class="text-h6 mb-5">Контактная информация</div>
    <div class="participant-contact">
      <div class="grid">
        <div class="grid-col-lg-7">
          <div class="d-sm-flex mb-6">
            <label class="form-field w-sm-1/2">
              <div class="text-body-1 text--demibold mb-2">E-mail</div>
              <div class="form-input-cover">
                <input type="text" class="form-input" name="email" required value="ivanov@yandex.ru">
              </div>
            </label>
            <label class="form-field w-sm-1/2 ml-sm-4 mt-4 mt-sm-0">
              <div class="text-body-1 text--demibold mb-2">Телефон</div>
              <div class="form-input-cover">
                <input type="tel" class="form-input" name="phone" required value="+7(900)111-22-33">
              </div>
            </label>
          </div>
          <div class="text-body-0 text--demibold mb-5">Документы</div>
          <div class="lk-top-docs__item mb-4" v-for="(doc,key) in data.documents">
            <img src="img/icons/file-add.png" alt="">
            <div class="text-body-2 text--underline">{{doc.title}}<span class="color-primary">*</span></div>
            <label v-show="!doc.file" class="btn btn--primary btn--link ml-auto ml-sm-2">
              <input type="file" accept="application/*" @change="docChangeHandler(key,$event)">
              Загрузить
            </label>
            <button v-show="doc.file" type="button" class="btn btn--primary btn--link ml-auto ml-sm-2" @click="docRemoveHandler(key)">Удалить</button>
          </div>
        </div>
        <div class="grid-col-lg-5">
          <label class="form-field w-100">
            <div class="text-body-1 text--demibold mb-2">Комментарий</div>
            <div class="form-input-cover">
              <textarea style="height: 246px;" name="comment" id="" class="form-input" cols="30" rows="10" value="Указан телефон отца — Иван Синельников"></textarea>
            </div>
          </label>
        </div>
      </div>
    </div>
    <div class="bd-top my-8"></div>
    <div class="text-h6 mb-5">Статистика</div>

    <div class="participant-table">

      <table class="admin-table text--center">
        <tr class="admin-table-head">
          <td class="admin-table-td px-2 py-4">
            <div class="text-small text--demibold">Сезон</div>
          </td>
          <td class="admin-table-td px-2 py-4">
            <div class="text-small text--demibold">Команда</div>
          </td>
          <td class="admin-table-td px-2 py-4">
            <div class="text-small text--demibold">Соревнование</div>
          </td>
          <td class="admin-table-td px-2 py-4">
            <div class="text-small text--demibold">Кол-во игр</div>
          </td>
          <td class="admin-table-td px-2 py-4">
            <div class="text-small text--demibold">Попытки</div>
          </td>
          <td class="admin-table-td px-2 py-4">
            <div class="text-small text--demibold">
              Предупреждения/ <br>
              удаления
            </div>
          </td>
        </tr>
        <tr>
          <td class="admin-table-td px-2 py-4">
            <div class="text-body-2 fade-80">2022/2023</div>
          </td>
          <td class="admin-table-td px-2 py-4">
            <div class="text-body-2 fade-80">ГБУ РО СШОР №5</div>
          </td>
          <td class="admin-table-td px-2 py-4">
            <div class="text-body-2 fade-80">Кубок Ростсельмаш по регби-7</div>
          </td>
          <td class="admin-table-td px-2 py-4">
            <div class="text-body-2 fade-80">4</div>
          </td>
          <td class="admin-table-td px-2 py-4">
            <div class="text-body-2 fade-80">9</div>
          </td>
          <td class="admin-table-td px-2 py-4">
            <div class="text-body-2 fade-80">2/0</div>
          </td>
        </tr>
      </table>
    </div>
    <div class="flex flex-align-center mt-8 flex-wrap">
      <button type="submit" class="btn btn--primary btn--fill px-10 w-100 w-sm-auto mb-4 mb-sm-0" :disabled="loading">
        <div class="progress progress-circle text-small fade-60" v-show="loading"></div>
        <span v-show="!loading">Сохранить</span>
      </button>
      <button type="button" class="btn btn--primary btn--light px-10 w-100 w-sm-auto ml-sm-4 mb-4 mb-sm-0" data-fancybox-close>Отмена</button>
      <div class="color-red ml-lg-8 " v-show="error">{{error}}</div>
    </div>
  </form>
</div>

<script>
  const app = Vue.createApp({
    data() {
      return {
        avatarFile: null,
        avatarRemove: false,
        loading: false,
        error: null,
        data: {
          id: 1000,
          avatar: 'img/test.gif',
          documents: {
            skan: {
              title: 'Скан-копия подписанной заявки',
              file: null,
              file_remove: false
            },
            strah: {
              title: 'Страхование',
              file: null,
              file_remove: false
            },
            lichnost: {
              title: 'Документ подтверждающий личность',
              file: null,
              file_remove: false
            },
            perdan: {
              title: 'Заявление об обработке персональных данных',
              file: null,
              file_remove: false
            }
          }
        }
      }
    },
    methods: {
      submitHandler(event) {
        event.preventDefault()
        const formData = new FormData(event.target)
        Object.entries(this.data.documents).forEach(([key, doc]) => {
          formData.append(key + '_file', doc.file)
        })

        formData.append('avatar_file', this.avatarFile)
        console.log(Object.fromEntries(formData));
        this.loading = true
        this.error = null

        setTimeout(() => {
          this.loading = false
          this.error = "*Такой игрок уже зарегистрирован, обратитесь в тех. поддержку"
        }, 1000)
      },
      avatarChangeHandler(event) {
        if (event.target.files.length > 0) {
          const file = event.target.files[0]
          this.avatarFile = file

          let reader = new FileReader();
          reader.readAsDataURL(file);

          this.avatarLodaing = true

          reader.onload = () => {
            this.data.avatar = reader.result
            this.avatarLodaing = false
          };
        }
      },
      docChangeHandler(key, event) {
        if (event.target.files.length > 0) {
          const file = event.target.files[0]
          this.data.documents[key].file = file
          this.data.documents[key].file_remove = false
        }
      },
      docRemoveHandler(key) {
        this.data.documents[key].file_remove = true
        this.data.documents[key].file = null
      }
    }
  })
  app.mount(document.getElementById('participant-edit'))
</script>